= Limitations and Restrictions

The following limitations and restrictions apply to any cluster managed by the Hazelcast Platform Operator.

== General Limitations

* **Dynamic scaling is not permitted when CP Subsystem is enabled.** The `spec.clusterSize` cannot be changed for clusters with `spec.cpSubsystem` enabled.

* **CP Subsystem cluster size restrictions.** Clusters with CP Subsystem enabled can only have 3, 5, or 7 members. The `spec.clusterSize` must be set to one of these values when `spec.cpSubsystem` is enabled.

* **Native Memory Allocator Type with Persistence.** When persistence is enabled, `spec.nativeMemory.allocatorType` must be set to `POOLED`. The `STANDARD` allocator type cannot be used when persistence is enabled.

* **Map Persistence requires Hazelcast Persistence.** Maps with `spec.persistenceEnabled` set to `true` require Hazelcast cluster persistence (`spec.persistence`) to be enabled.

* **Map Native Memory Format requires Hazelcast Native Memory.** Maps with `spec.inMemoryFormat` set to `NATIVE` require Hazelcast cluster Native Memory (`spec.nativeMemory`) to be enabled.

* **SQL Catalog Persistence requires Hazelcast Persistence.** SQL Catalog Persistence (`spec.sql.catalogPersistenceEnabled`) requires Hazelcast persistence (`spec.persistence`) to be enabled.

* **Jet Lossless Restart requires Persistence.** Jet Engine lossless restart (`spec.jet.instance.losslessRestartEnabled`) can only be enabled if Hazelcast persistence is enabled.

* **Diagnostics Configuration Conflict.** Diagnostic configuration (`spec.diagnostics`) is not allowed when the `hazelcast.diagnostics.enabled` property is specified in `spec.properties`.

* **Management Center Diagnostic Logs Limitation.** Management Center cannot enable diagnostic logs in Operator, Kubernetes, and Docker deployments because the default diagnostic log location (`/opt/hazelcast`) is read-only in these environments. To work around this, users can direct diagnostic logs to STDOUT via Management Center, where they will mix with standard logs and can be picked up by log scraping services for persistence.

* **OpenShift Route Limitation.** Management Center Route (`spec.externalConnectivity.route`) can only be enabled in OpenShift environments.

* **Persistence Startup Action Restriction.** `spec.persistence.startupAction` with value `"PartialStart"` can only be used when `spec.persistence.clusterDataRecoveryPolicy` is set to `"Partial"`. PartialStart cannot be used with FullRecovery policy.

== Custom Resource (CR) Limitations and Restrictions

All following limitations and restrictions apply to custom resources related to Hazelcast Platform Operator.

=== Hazelcast CR

* **High Availability Mode** cannot be updated. The `spec.highAvailabilityMode` field cannot be changed after initial deployment.

* **Persistence configuration** cannot be enabled or disabled after the cluster has been created. The `spec.persistence` field cannot be added or removed from an existing cluster.

* **Persistence PVC configuration** cannot be updated. The `spec.persistence.pvc` field cannot be modified after initial deployment.

* **Persistence restore configuration** cannot be updated. The `spec.persistence.restore` field cannot be modified after initial deployment.

* **CP Subsystem** cannot be enabled or disabled after the cluster has been created. The `spec.cpSubsystem` field cannot be added or removed from an existing cluster.

* **CP Subsystem PVC configuration** cannot be updated. The `spec.cpSubsystem.pvc` field cannot be modified after initial deployment.

* **SQL Catalog Persistence** cannot be disabled after it has been enabled. Once `spec.sql.catalogPersistenceEnabled` is set to `true`, it cannot be changed back to `false`.

* **Persistent Volume Claims** defined in `spec.persistenceVolumeClaims` cannot be removed or have their storage class or access modes changed after initial deployment. New PVCs can be added, but existing ones cannot be modified.

* **Expose Externally Member Access:** `spec.exposeExternally.memberAccess` cannot be set when `spec.exposeExternally.type` is set to `"Unisocket"`. Member access configuration is only valid for `"Smart"` client type.

* **Advanced Network WAN Service Type:** `spec.advancedNetwork.wan[].serviceType` with value `"WithExposeExternally"` can only be used when `spec.exposeExternally` is enabled.


=== Map CR

The following fields in the `Map` CR cannot be updated after the map configuration is created:

* `spec.name` - Map name
* `spec.backupCount` - Backup count
* `spec.asyncBackupCount` - Async backup count
* `spec.indexes` - Index configurations
* `spec.persistenceEnabled` - Persistence enabled flag
* `spec.hazelcastResourceName` - Associated Hazelcast resource name
* `spec.inMemoryFormat` - In-memory format
* `spec.eventJournal` - Event journal configuration
* `spec.nearCache` - Near cache configuration

=== JetJob CR

The following fields in the `JetJob` CR cannot be updated after the job is created:

* `spec.name` - Job name
* `spec.hazelcastResourceName` - Associated Hazelcast resource name
* `spec.jarName` - JAR file name
* `spec.mainClass` - Main class name
* `spec.initialSnapshotResourceName` - Initial snapshot resource name
* `spec.bucketConfiguration` - Bucket configuration (cannot be added or removed)
* `spec.bucketConfiguration.bucketURI` - Bucket URI
* `spec.bucketConfiguration.secretName` - Bucket secret name
* `spec.remoteURL` - Remote URL (cannot be added or removed)

**Note:** JetJob state changes are restricted when the job execution is finished or being finished. State changes are only allowed for jobs in `Running` status.

=== JetJobSnapshot CR

* **Entire spec cannot be updated.** The `JetJobSnapshot` CR spec cannot be modified after creation.

=== WAN Replication CR

The following fields in the `WanReplication` CR cannot be updated after creation:

* `spec.targetClusterName` - Target cluster name
* `spec.endpoints` - Endpoints configuration
* `spec.queue` - Queue configuration
* `spec.batch` - Batch configuration
* `spec.acknowledgement` - Acknowledgement configuration


=== WAN Sync CR

* **WAN Replication Resource Name** cannot be updated. The `spec.wanReplicationResourceName` field cannot be changed after creation.

=== MultiMap, Topic, Queue, Cache, Vector Collection, ReplicatedMap CRDs

The following data structure Custom Resources have their entire spec immutable after resource creation:

- MultiMap
- Topic
- Queue
- Cache
- Vector Collection
- ReplicatedMap

=== HotBackup CR

* **HotBackup cannot be deleted when referenced by Hazelcast restore.** A `HotBackup` CR cannot be deleted if any `Hazelcast` resource in the same namespace references it in `spec.persistence.restore.hotBackupResourceName`. You must first remove or update the Hazelcast resource's restore configuration before deleting the HotBackup.

* **HotBackup requires Hazelcast Persistence.** HotBackup can only be created for Hazelcast clusters that have persistence enabled (`spec.persistence` must be enabled). The Hazelcast cluster must have persistence configured before creating a HotBackup resource.

=== Management Center CR

* **Persistence configuration** cannot be enabled, disabled, or updated after creation. The `spec.persistence` field and all its sub-fields cannot be modified after initial deployment.

== Parameters That Trigger Rolling Updates

Modifying the following parameters in the Hazelcast Custom Resource will trigger a rolling update (RU) of the cluster. These parameters affect the StatefulSet pod template and require pod restarts to apply changes:

=== Hazelcast CR

**Cluster Configuration:**

* `spec.clusterName` - Name of the Hazelcast cluster
* `spec.clusterSize` - Number of Hazelcast members in the cluster (restricted when CP Subsystem is enabled)
* `spec.licenseKeySecretName` - Name of the secret with Hazelcast Enterprise License Key

**Lite Members:**

* `spec.liteMember.count` - Number of lite members

**Image Configuration:**

* `spec.repository` - Repository to pull the Hazelcast Platform image from
* `spec.version` - Version of Hazelcast Platform
* `spec.imagePullPolicy` - Pull policy for the Hazelcast Platform image
* `spec.imagePullSecrets` - Image pull secrets for the Hazelcast Platform image

**Agent Configuration:**

* `spec.agent.repository` - Repository to pull the Agent image from
* `spec.agent.version` - Version of Hazelcast Platform Operator Agent
* `spec.agent.resources` - Compute Resources required by the Agent container

**Resource Configuration:**

* `spec.resources` - Compute Resources required by the Hazelcast container
* `spec.liteMember.resources` - Compute Resources required by lite members

**Scheduling Configuration:**

* `spec.scheduling.affinity` - Pod affinity rules
* `spec.scheduling.tolerations` - Pod tolerations
* `spec.scheduling.nodeSelector` - Node selector
* `spec.scheduling.topologySpreadConstraints` - Topology spread constraints
* `spec.liteMember.scheduling.*` - Lite member scheduling configuration
* `spec.highAvailabilityMode` - High Availability Mode (affects topology spread constraints)

**JVM Configuration:**

* `spec.jvm.*` - Hazelcast JVM configuration (memory, GC, args)
* `spec.liteMember.jvm.*` - Lite member JVM configuration

**TLS Configuration:**

* `spec.tls.*` - TLS configuration for Hazelcast members

**Advanced Network Configuration:**

* `spec.advancedNetwork.*` - Advanced network configuration

**Module Deployment:**

* `spec.moduleDeployment.*` - Module deployment configuration
* `spec.moduleDeployment.bucketConfiguration.*` - Bucket configuration for module deployment
* `spec.moduleDeployment.remoteURLs` - Remote URLs for module deployment
* `spec.moduleDeployment.configMaps` - ConfigMaps for module deployment
* `spec.moduleDeployment.triggerSequence` - Trigger sequence (affects ConfigMap volume names)
* `spec.userCodeNamespaces.*` - User code namespaces configuration (affects volumes, volume mounts, init container, and Hazelcast config)

**Service Account:**

* `spec.serviceAccountName` - Name of the ServiceAccount to use

**Native Memory:**

* `spec.nativeMemory.*` - Hazelcast Native Memory (HD Memory) configuration

**Serialization:**

* `spec.serialization.*` - Hazelcast serialization configuration

**Jet Engine Configuration:**

* `spec.jet.*` - Jet Engine configuration (except `spec.jet.instance.losslessRestartEnabled` which requires persistence to be enabled)

**CP Subsystem Configuration:**

* `spec.cpSubsystem.*` - CP Subsystem configuration (except enabling/disabling CP Subsystem itself and PVC configuration which cannot be updated)

**Management Center Configuration:**

* `spec.managementCenter.*` - Management Center configuration (scripting, console, data access settings)

**SQL:**

* `spec.sql.*` - Hazelcast SQL configuration (except `catalogPersistenceEnabled` which cannot be disabled once enabled)

**Security:**

* `spec.security.*` - Security configuration

**Diagnostics:**

* `spec.diagnostics.*` - Diagnostics logging configuration

**Expose Externally:**

* `spec.exposeExternally.*` - Configuration to expose Hazelcast cluster to external clients

**Executor Services:**

* `spec.executorServices` - Executor service configurations (affects Hazelcast config Secret)
* `spec.durableExecutorServices` - Durable executor service configurations (affects Hazelcast config Secret)
* `spec.scheduledExecutorServices` - Scheduled executor service configurations (affects Hazelcast config Secret)

**Custom Configuration:**

* `spec.customConfigCmName` - Custom configuration ConfigMap name (affects Hazelcast config Secret)

**Persistence Volume Claims:**

* `spec.persistenceVolumeClaims` - Additional Persistent Volume Claims (new PVCs can be added, but existing PVCs cannot be modified; affects volumes and volume mounts)

**Properties:**

* `spec.properties` - Hazelcast system properties

**Environment Variables:**

* `spec.env` - Environment variables for Hazelcast container
* `spec.liteMember.env` - Environment variables for lite members
* `spec.loggingLevel` - Logging level for Hazelcast members

**Kubernetes Metadata:**

* `spec.annotations` - Kubernetes resource annotations (applied to pods and other resources)
* `spec.labels` - Kubernetes resource labels (applied to pods)

=== Management Center CR

The following parameters in the `ManagementCenter` CR will trigger a rolling update:

**Image Configuration:**

* `spec.repository` - Repository to pull the Management Center image from
* `spec.version` - Version of Management Center
* `spec.imagePullPolicy` - Pull policy for the Management Center image
* `spec.imagePullSecrets` - Image pull secrets for the Management Center image

**Resource Configuration:**

* `spec.resources` - Compute Resources required by the MC container

**Scheduling Configuration:**

* `spec.scheduling.*` - Scheduling details (affinity, tolerations, nodeSelector, topologySpreadConstraints)

**JVM Configuration:**

* `spec.jvm.*` - Management Center JVM configuration

**Environment Variables:**

* `spec.env` - Environment variables for MC container

**External Connectivity:**

* `spec.externalConnectivity.*` - Configuration to expose Management Center to outside

**Security Providers:**

* `spec.securityProvider.*` - Security providers to authenticate users

== Manual Actions not Recognized by The Operator

The following actions performed manually or through Management Center (MC) are **not recognized** by the operator and will not be reflected in the Custom Resource status or configuration:

* **Creating Maps:** Creating maps directly through Management Center UI or REST API will not be recognized by the operator. Maps should be created using the `Map` Custom Resource.

* **Starting JetJobs:** Starting Jet jobs directly through Management Center UI or REST API will not be recognized by the operator. Jet jobs should be managed using the `JetJob` Custom Resource.

* **Demoting/Promoting Lite Members:** Changing the lite member status (demoting full members to lite members or promoting lite members to full members) through Management Center or Hazelcast REST API will not be recognized by the operator. Lite member configuration should be managed through the `Hazelcast` CR `spec.liteMember` field.

* **Changing Cluster State:** Changing the cluster state (e.g., from ACTIVE to PASSIVE or vice versa) through Management Center or Hazelcast REST API will not be recognized by the operator. Cluster state changes should be managed through appropriate Custom Resources (e.g., `HotBackup` CR for backup operations).

* **Dynamic Configuration Changes:** Changes made to Hazelcast configuration through Management Center's dynamic configuration feature or REST API may not be persisted or recognized by the operator. Configuration should be managed through Custom Resources.

* **Data Structure Operations:** Creating, modifying, or deleting data structures (Queues, Topics, MultiMaps, etc.) through Management Center or client APIs will not be tracked by the operator. Use the appropriate Custom Resources (e.g., `Queue`, `Topic`, `MultiMap`) to manage data structures.

== Other Limitations

* **Community Edition:** Hazelcast Platform Operator only supports Hazelcast Enterprise Edition. Community Edition is not supported.

* **Backup and Restore:** Hot backups created manually outside of the `HotBackup` Custom Resource will not be tracked or managed by the operator.
